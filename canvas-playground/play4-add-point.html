<!DOCTYPE html>
<html>
<head>
    <title>Jog JS test</title>
</head>
<body>

<div id="main" style="padding: 50px;">
    <div id="my-canvas-test">
        
    </div>
</div>

<script type="text/javascript">

    /*
        // CLASS: Jogger 

        // MEMBERS: 
        xScale
        yScale
        yGrowHysteresis
        yShrinkHysteresis
        scrollRate
        startTime
        dataBuffer
        lineColors
        lineThicknesses
        lineStyles
        backgroundColor
        resizeDetectTimeout
        containerElement
        canvasElement
        ctx


        // CONSTRUCTOR PARAMS: dimension_settings, control_settings, style_settings, document_settings

        DIMENSION
         - xScale is a single number representing how many x units to show in the windowSize. Defaults to 10 horizontal pixels per x Unit, rounding down. If "continuous", the x scale has a minimum of 3 seconds and stretches to fit all data plus 25%, ceasing to stretch and beginning to throw away past data when data reaches 1MB in size. 
         - scrollRate is a number representing the time frequency of x units. Defaults to 1 (i.e. 1 x unit per second).
         - yScale is a list of coordinate pairs representing the different y ranges. The chart will smoothly scale between these different ranges. Default value is a single unit range: [[0,1]].
         - yGrowHysteresis is the number of most recent x frames used to determine the y scale as it grows to accomodate new out-of-range data. A value of "all" uses the entire history as a running average, and a value of "screen" uses all the data on the screen.
         - yShrinkHystersis is the portion of the screen used to determine the y scale as it shrinks to accomodate data that is undersized for the current yScale range.

        CONTROL
         - scrollRate is the ratio of x units to seconds - default is 1.
         - startTime is the UTC timestamp corresponding to the first data point ingested.
         - dataBuffer is an array used to hold all data points needed for the graph.
         - dataBufferSize is the length of the data buffer in x units.

        STYLE - Each is an array of items in order corresponding to the (perhaps multiple) data series. Items should be specified as CSS strings.
         - lineColors defaults to black.
         - lineThicknesses defaults to "2px". 
         - lineStyles defaults to "solid" but may be dotted or dashed
         - backgroundColor defaults to white


        DOCUMENT
         - containerElement - the div containing the canvas (the outer "window" of the chart)
         - canvasElement - the element 
         - ctx

    */
    class Jogger {

        constructor(
            dimension_settings={startWidth:400, startHeight:100, xScale:10, yScale:[[0,1]], yGrowHysteresis:2, yShrinkHysteresis:0.5}, 
            control_settings=
                {scrollRate:1, startTime:new Date().getTime(), dataBufferSize:1000,}, 
            style_settings=
                {backgroundColor:"rgba(0,0,0,0)", margin:"30px"}, 
            document_settings=
                {containerId:"jog-" + new Date().getTime().toString(), canvasId:"jog-canvas-" + new Date().getTime().toString(), resizeDetectTimeout:100,},
            series=
                [{name:"", yScale:dimension_settings.yScale[0], lineColor:"rgba(0,0,0,1)", lineThickness:"rgba(0,0,0,.5)", lineStyle: "solid", dataBuffer: [[0, control_settings.startTime, 0]], latestMove:[1,1], }]
        ) {


            this.resizeDetectTimeout = document_settings.resizeDetectTimeout;
            this.containerElement = document.createElement("div");
            this.containerElement.id = document_settings.containerId;
            this.canvasElement = document.createElement("canvas");
            this.canvasElement.id = document_settings.canvasId;
            this.containerElement.style.overflow = "hidden";
            this.canvasElement.style.marginLeft="0";
            this.containerElement.appendChild(this.canvasElement);

            this.containerElement.style.width = dimension_settings.startWidth.toString() + "px";
            this.canvasElement.style.width = dimension_settings.startWidth.toString() + "px";
            this.containerElement.style.height = dimension_settings.startHeight.toString() + "px";
            this.canvasElement.style.height = dimension_settings.startHeight.toString() + "px";
            this.xScale = dimension_settings.xScale;
            this.yGrowHysteresis = dimension_settings.yGrowHysteresis;
            this.yShrinkHysteresis = dimension_settings.yShrinkHysteresis;

            this.scrollRate = control_settings.scrollRate;
            this.startTime = control_settings.startTime;
            this.timeDelta = new Date().getTime() - control_settings.startTime;
            this.dataBufferSize = control_settings.dataBufferSize;

            this.canvasElement.style.backgroundColor = style_settings.backgroundColor;
            this.containerElement.style.margin = style_settings.margin;

            this.series = series;
            if (! this.series[0].context) {this.series[0].context = this.canvasElement.getContext("2d");}

        }

        applyStyle(newStyle = {}) {}

        pushDatum(series, normX, normY) {
            this.series[series].latestMove = [normX, normY];
            this.series[series].dataBuffer.push([this.series[series].dataBuffer.length, normX / this.scrollRate, normY]);
        }

        moveTo(series, normX, normY) {
            this.series[series].latestMove = [normX, normY];
            let ctx = this.series[series].context;
            var cX = normX * this.containerElement.offsetWidth;
            var cY = normY * this.containerElement.offsetHeight;
            ctx.moveTo(normX, normY);
        }

        drawLineTo(series, normX, normY) {
            this.latestMove = [normX, normY];
            let ctx = this.series[series].context;
            var cX = normX * this.containerElement.offsetWidth;
            var cY = normY * this.containerElement.offsetHeight;
            ctx.lineTo(normX, normY);
            ctx.stroke();
        }

    } // end of class Jogger

    var j = new Jogger();
    j.canvasElement.style.background="linear-gradient(to left, blue, red)";
    document.getElementById("main").appendChild(j.containerElement);
    j.moveTo(0,0,0);
    j.drawLineTo(0,100,100);
    j.drawLineTo(0,200,0);


    var mdiv = document.getElementById("my-canvas-test");
    var canv = document.createElement("canvas");
    var latestMove;
    canv.id="can0";
    // canv.width=600;
    canv.style.background="linear-gradient(to left, blue, red)";
    canv.style.marginLeft="0";
    mdiv.style.width="200px";
    mdiv.style.overflow="hidden";
    mdiv.appendChild(canv);
    canv.onmousedown=e=>{canv.style.outline="3px solid green"; canv.style.outlineOffset="-3px";};
    canv.onmousemove=e=>{
        if ( document.querySelector('#can0:active') ) {
            canv.style.marginLeft = (parseInt(canv.style.marginLeft.split('px')[0]) + e.movementX) + "px";
        }
    };
    canv.onmouseup=e=>{canv.style.outline="none";}

    function setScroll(x){
        if(x == undefined) {

            canv.style.marginLeft = (mdiv.offsetWidth - canv.width)+"px";
        }
        else canv.style.marginLeft = x;
    }


</script>


</body>
</html>